<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updates on Laura's conditions </title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cream: #faf8f5;
            --warm-white: #ffffff;
            --sage: #a8b5a0;
            --deep-sage: #6b7a63;
            --terracotta: #d4a88f;
            --soft-gray: #e8e6e3;
            --text-dark: #2d3436;
            --text-light: #636e72;
            --admin-blue: #5b8ab8;
            --admin-dark: #3d5a7a;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #f5f3ef 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .grain-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            z-index: 1;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 3.5rem;
            font-weight: 300;
            color: var(--deep-sage);
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 400;
        }

        .admin-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--admin-blue), var(--admin-dark));
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(61, 90, 122, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
            border: none;
            font-size: 1.5rem;
        }

        .admin-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(61, 90, 122, 0.5);
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .admin-panel.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px;
        }

        .admin-content {
            background: var(--warm-white);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            position: relative;
            animation: slideIn 0.4s ease-out;
            margin: auto;
        }

        .admin-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--soft-gray);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .admin-close:hover {
            background: var(--text-light);
            color: white;
        }

        .admin-header {
            margin-bottom: 30px;
        }

        .admin-header h2 {
            font-family: 'Crimson Pro', serif;
            font-size: 2rem;
            color: var(--admin-dark);
            margin-bottom: 10px;
        }

        .admin-section {
            margin-bottom: 35px;
            padding: 25px;
            background: var(--cream);
            border-radius: 15px;
            border-left: 4px solid var(--admin-blue);
        }

        .admin-section h3 {
            font-family: 'Crimson Pro', serif;
            color: var(--admin-dark);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .card {
            background: var(--warm-white);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--soft-gray);
            animation: fadeInUp 0.8s ease-out;
            animation-fill-mode: both;
        }

        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--soft-gray);
        }

        .icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--sage), var(--deep-sage));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        h2 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--deep-sage);
        }

        .update-content {
            background: linear-gradient(135deg, #f9f7f4 0%, var(--cream) 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid var(--terracotta);
            margin-bottom: 20px;
        }

        .update-date {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .update-text {
            font-size: 1.05rem;
            color: var(--text-dark);
            line-height: 1.7;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        input, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--soft-gray);
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--warm-white);
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--sage);
            box-shadow: 0 0 0 3px rgba(168, 181, 160, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .button {
            background: linear-gradient(135deg, var(--sage), var(--deep-sage));
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            box-shadow: 0 4px 15px rgba(107, 122, 99, 0.3);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 122, 99, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-admin {
            background: linear-gradient(135deg, var(--admin-blue), var(--admin-dark));
            box-shadow: 0 4px 15px rgba(61, 90, 122, 0.3);
        }

        .button-admin:hover {
            box-shadow: 0 6px 20px rgba(61, 90, 122, 0.4);
        }

        .button-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .button-danger:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .message-item {
            background: var(--cream);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 3px solid var(--terracotta);
            animation: slideIn 0.4s ease-out;
            position: relative;
        }

        .message-author {
            font-weight: 600;
            color: var(--deep-sage);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .message-text {
            color: var(--text-dark);
            line-height: 1.6;
        }

        .message-date {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 8px;
        }

        .message-admin-controls {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .visitation-item {
            background: var(--cream);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.4s ease-out;
            position: relative;
        }

        .visitation-info {
            flex: 1;
        }

        .visitation-name {
            font-weight: 600;
            color: var(--deep-sage);
            margin-bottom: 3px;
        }

        .visitation-time {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .visitation-phone {
            font-size: 0.85rem;
            color: var(--admin-dark);
            margin-top: 3px;
        }

        .visitation-admin-controls {
            margin-left: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
            font-style: italic;
        }

        .success-message {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
            animation: slideIn 0.4s ease-out;
        }

        .error-message {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #dc3545;
            animation: slideIn 0.4s ease-out;
        }

        .admin-list-item {
            background: var(--warm-white);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--soft-gray);
        }

        .admin-list-content {
            flex: 1;
            margin-right: 15px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .card {
                padding: 25px;
            }
            
            .container {
                padding: 20px 15px;
            }

            .admin-content {
                padding: 25px;
            }

            .admin-toggle {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="grain-overlay"></div>
    
    <!-- Admin Toggle Button -->
    <button class="admin-toggle" id="adminToggle" title="Admin Panel">‚öôÔ∏è</button>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <button class="admin-close" id="adminClose">√ó</button>
            
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <p style="color: var(--text-light);">Manage updates, messages, and visitation requests</p>
            </div>

            <!-- Login Section -->
            <div id="adminLogin">
                <div class="admin-section">
                    <h3>Admin Login</h3>
                    <div id="loginError"></div>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="adminPassword">Password</label>
                            <input type="password" id="adminPassword" required placeholder="Enter admin password">
                            <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 8px;">
                                Default password: <strong>admin123</strong> (Change this after first login!)
                            </p>
                        </div>
                        <button type="submit" class="button button-admin">Login</button>
                    </form>
                </div>
            </div>

            <!-- Admin Controls (hidden until logged in) -->
            <div id="adminControls" style="display: none;">
                
                <!-- Post New Update -->
                <div class="admin-section">
                    <h3>Post New Update</h3>
                    <div id="updateSuccess"></div>
                    <form id="adminUpdateForm">
                        <div class="form-group">
                            <label for="updateText">Update Message</label>
                            <textarea id="updateText" required placeholder="Share the latest news..."></textarea>
                        </div>
                        <button type="submit" class="button button-admin">Post Update</button>
                    </form>
                </div>

                <!-- Manage Messages -->
                <div class="admin-section">
                    <h3>Manage Messages</h3>
                    <div id="adminMessagesList"></div>
                </div>

                <!-- View Visitation Requests -->
                <div class="admin-section">
                    <h3>Visitation Requests</h3>
                    <div id="adminVisitationList"></div>
                </div>

                <!-- Change Password -->
                <div class="admin-section">
                    <h3>Change Password</h3>
                    <div id="passwordSuccess"></div>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" required placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" required placeholder="Confirm new password">
                        </div>
                        <button type="submit" class="button button-admin">Update Password</button>
                    </form>
                </div>

                <button class="button button-danger" id="logoutBtn" style="width: 100%; margin-top: 20px;">Logout</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>Care & Updates</h1>
            <p class="subtitle">A place to stay connected and share support</p>
        </header>

        <!-- Latest Update Section -->
        <div class="card">
            <div class="card-header">
                <div class="icon">üìã</div>
                <h2>Latest Update</h2>
            </div>
            <div id="latestUpdate" class="update-content">
                <div class="update-date">Loading...</div>
                <div class="update-text">First, let me (Rob) say thanks for all your prayers and concerns and I apologize that in general I have not been able to update family, friends, colleagues etc in a timely fashion. You probably know some of this, but tues jan 27th around 8 Laura was driving alone and turning from Park to Regent. A car blew through a red light and hit her, and then both of their cars crashed into other cars. Laura never lost consciousness, and a super helpful stranger opened her door and kept her calm until the police arrived, but she has a fractured pelvis, a couple of broken ribs, and some spinal processes fractured. Between being at the hospital for her, dealing with the aftermath, insurance, new car etc I‚Äôm gonna be pretty busy but a vague outline of the next few weeks/ months is emerging, as long as bumps on the road to recovery don‚Äôt arise‚Ä¶.
	Laura is at UW Hospital and currently, visitors are not yet appropriate. The many offers of food and help are not needed. She will soon transition to a rehab hospital likely UW East and then visitors are likely welcomed. Laura‚Äôs lab will update this ‚Äúblog‚Äù and maintain a schedule of visitors. A few requests if you sign up to visit, but don‚Äôt feel ‚Äúobligated‚Äù we appreciate your concern and know you guys care whether you visit or not.
Check the blog the day of before you go‚Ä¶it might be updated to not come, or bring something specific‚Ä¶for example while Laura loves chocolate, she currently can‚Äôt tolerate anything sweet. Hopefully that will change‚Ä¶but hence the need to check the blog
Currently keep visitors to 2 at a time and for < than an hour, again this may change
I estimate she will be at the US rehab till  ~ feb 10th, and then home and need support until mid march maybe longer. Frankly, visits to our house 2222 kendall in the weeks after rehab maybe the most helpful. We have Oceane and Jonas living with us, so she will have some support, but Rob, Oceane and Jonas all have some responsibilities outside of the house so we can‚Äôt be with her 24/7.
Finally, feel free to share the page with others and post here, Laura has a wide network of support inside and outside Madison and please don‚Äôt take offense if I didn‚Äôt share this blog with you personally right away. I appreciate all thoughts and comments:
</div>
            </div>
        </div>

        <!-- Leave a Message Section -->
        <div class="card">
            <div class="card-header">
                <div class="icon">üíå</div>
                <h2>Leave a Message</h2>
            </div>
            <div id="messageSuccess"></div>
            <form id="messageForm">
                <div class="form-group">
                    <label for="messageName">Your Name</label>
                    <input type="text" id="messageName" required placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="messageText">Your Message</label>
                    <textarea id="messageText" required placeholder="Share your thoughts, prayers, or well wishes..."></textarea>
                </div>
                <button type="submit" class="button">Send Message</button>
            </form>
            
            <div style="margin-top: 40px;">
                <h3 style="font-family: 'Crimson Pro', serif; color: var(--deep-sage); margin-bottom: 20px;">Recent Messages</h3>
                <div id="messagesList"></div>
            </div>
        </div>

        <!-- Visitation Sign-up Section -->
        <div class="card">
            <div class="card-header">
                <div class="icon">üóìÔ∏è</div>
                <h2>Sign Up for Visitation</h2>
            </div>
            <div id="visitSuccess"></div>
            <form id="visitationForm">
                <div class="form-group">
                    <label for="visitorName">Your Name</label>
                    <input type="text" id="visitorName" required placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="visitDate">Preferred Date</label>
                    <input type="date" id="visitDate" required>
                </div>
                <div class="form-group">
                    <label for="visitTime">Preferred Time</label>
                    <input type="time" id="visitTime" required>
                </div>
                <div class="form-group">
                    <label for="visitPhone">Phone Number (optional)</label>
                    <input type="tel" id="visitPhone" placeholder="For confirmation">
                </div>
                <button type="submit" class="button">Request Visit</button>
            </form>
            
            <div style="margin-top: 40px;">
                <h3 style="font-family: 'Crimson Pro', serif; color: var(--deep-sage); margin-bottom: 20px;">Upcoming Visits</h3>
                <div id="visitationList"></div>
            </div>
        </div>
    </div>

    <script>
        let isAdminLoggedIn = false;

        // Initialize storage and load data
        async function init() {
            await loadLatestUpdate();
            await loadMessages();
            await loadVisitations();
            await initializePassword();
        }

        // Initialize default password if not set
        async function initializePassword() {
            try {
                await window.storage.get('admin-password', false);
            } catch (error) {
                // Set default password
                await window.storage.set('admin-password', 'admin123', false);
            }
        }

        // Admin Panel Toggle
        document.getElementById('adminToggle').addEventListener('click', () => {
            document.getElementById('adminPanel').classList.add('active');
        });

        document.getElementById('adminClose').addEventListener('click', () => {
            document.getElementById('adminPanel').classList.remove('active');
        });

        // Close admin panel when clicking outside
        document.getElementById('adminPanel').addEventListener('click', (e) => {
            if (e.target.id === 'adminPanel') {
                document.getElementById('adminPanel').classList.remove('active');
            }
        });

        // Admin Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            try {
                const result = await window.storage.get('admin-password', false);
                const storedPassword = result ? result.value : 'admin123';
                
                if (password === storedPassword) {
                    isAdminLoggedIn = true;
                    document.getElementById('adminLogin').style.display = 'none';
                    document.getElementById('adminControls').style.display = 'block';
                    document.getElementById('loginError').innerHTML = '';
                    document.getElementById('loginForm').reset();
                    
                    // Load admin data
                    await loadAdminMessages();
                    await loadAdminVisitations();
                } else {
                    document.getElementById('loginError').innerHTML = '<div class="error-message">Incorrect password. Please try again.</div>';
                }
            } catch (error) {
                console.error('Login error:', error);
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            isAdminLoggedIn = false;
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminControls').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        });

        // Change Password
        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                document.getElementById('passwordSuccess').innerHTML = '<div class="error-message">Passwords do not match!</div>';
                setTimeout(() => {
                    document.getElementById('passwordSuccess').innerHTML = '';
                }, 3000);
                return;
            }
            
            try {
                await window.storage.set('admin-password', newPassword, false);
                document.getElementById('passwordSuccess').innerHTML = '<div class="success-message">Password updated successfully!</div>';
                document.getElementById('changePasswordForm').reset();
                
                setTimeout(() => {
                    document.getElementById('passwordSuccess').innerHTML = '';
                }, 3000);
            } catch (error) {
                console.error('Password change error:', error);
            }
        });

        // Post New Update
        document.getElementById('adminUpdateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const text = document.getElementById('updateText').value;
            
            const update = {
                date: new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                }),
                text: text,
                timestamp: new Date().toISOString()
            };
            
            try {
                await window.storage.set('latest-update', JSON.stringify(update), false);
                
                document.getElementById('updateSuccess').innerHTML = '<div class="success-message">Update posted successfully!</div>';
                document.getElementById('adminUpdateForm').reset();
                
                await loadLatestUpdate();
                
                setTimeout(() => {
                    document.getElementById('updateSuccess').innerHTML = '';
                }, 3000);
            } catch (error) {
                alert('Error posting update. Please try again.');
                console.error('Error:', error);
            }
        });

        // Load latest update
        async function loadLatestUpdate() {
            try {
                const result = await window.storage.get('latest-update', false);
                if (result && result.value) {
                    const update = JSON.parse(result.value);
                    document.getElementById('latestUpdate').innerHTML = `
                        <div class="update-date">${update.date}</div>
                        <div class="update-text">${update.text}</div>
                    `;
                } else {
                    const defaultUpdate = {
                        date: new Date().toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        }),
                        text: 'Welcome! This page will be updated regularly with news. Check back soon for the latest information.'
                    };
                    await window.storage.set('latest-update', JSON.stringify(defaultUpdate), false);
                    document.getElementById('latestUpdate').innerHTML = `
                        <div class="update-date">${defaultUpdate.date}</div>
                        <div class="update-text">${defaultUpdate.text}</div>
                    `;
                }
            } catch (error) {
                const defaultUpdate = {
                    date: new Date().toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }),
                    text: 'Welcome! This page will be updated regularly with news. Check back soon for the latest information.'
                };
                await window.storage.set('latest-update', JSON.stringify(defaultUpdate), false);
                document.getElementById('latestUpdate').innerHTML = `
                    <div class="update-date">${defaultUpdate.date}</div>
                    <div class="update-text">${defaultUpdate.text}</div>
                `;
            }
        }

        // Load messages
        async function loadMessages() {
            try {
                const keys = await window.storage.list('message:', true);
                if (keys && keys.keys && keys.keys.length > 0) {
                    const messages = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key, true);
                            if (result && result.value) {
                                messages.push({...JSON.parse(result.value), key: key});
                            }
                        } catch (e) {
                            console.log('Error loading message:', e);
                        }
                    }
                    
                    messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    displayMessages(messages);
                } else {
                    document.getElementById('messagesList').innerHTML = '<div class="empty-state">No messages yet. Be the first to share your support!</div>';
                }
            } catch (error) {
                document.getElementById('messagesList').innerHTML = '<div class="empty-state">No messages yet. Be the first to share your support!</div>';
            }
        }

        // Display messages
        function displayMessages(messages) {
            const container = document.getElementById('messagesList');
            if (messages.length === 0) {
                container.innerHTML = '<div class="empty-state">No messages yet. Be the first to share your support!</div>';
                return;
            }
            
            container.innerHTML = messages.map(msg => `
                <div class="message-item">
                    <div class="message-author">${escapeHtml(msg.name)}</div>
                    <div class="message-text">${escapeHtml(msg.text)}</div>
                    <div class="message-date">${new Date(msg.timestamp).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric',
                        hour: 'numeric',
                        minute: '2-digit'
                    })}</div>
                </div>
            `).join('');
        }

        // Load admin messages
        async function loadAdminMessages() {
            try {
                const keys = await window.storage.list('message:', true);
                if (keys && keys.keys && keys.keys.length > 0) {
                    const messages = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key, true);
                            if (result && result.value) {
                                messages.push({...JSON.parse(result.value), key: key});
                            }
                        } catch (e) {
                            console.log('Error loading message:', e);
                        }
                    }
                    
                    messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    displayAdminMessages(messages);
                } else {
                    document.getElementById('adminMessagesList').innerHTML = '<div class="empty-state">No messages yet.</div>';
                }
            } catch (error) {
                document.getElementById('adminMessagesList').innerHTML = '<div class="empty-state">No messages yet.</div>';
            }
        }

        // Display admin messages
        function displayAdminMessages(messages) {
            const container = document.getElementById('adminMessagesList');
            if (messages.length === 0) {
                container.innerHTML = '<div class="empty-state">No messages yet.</div>';
                return;
            }
            
            container.innerHTML = messages.map(msg => `
                <div class="admin-list-item">
                    <div class="admin-list-content">
                        <strong>${escapeHtml(msg.name)}</strong><br>
                        <span style="color: var(--text-light); font-size: 0.9rem;">${escapeHtml(msg.text)}</span><br>
                        <span style="color: var(--text-light); font-size: 0.85rem;">${new Date(msg.timestamp).toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric',
                            hour: 'numeric',
                            minute: '2-digit'
                        })}</span>
                    </div>
                    <button class="button button-danger" onclick="deleteMessage('${msg.key}')">Delete</button>
                </div>
            `).join('');
        }

        // Delete message
        async function deleteMessage(key) {
            if (!confirm('Are you sure you want to delete this message?')) return;
            
            try {
                await window.storage.delete(key, true);
                await loadMessages();
                await loadAdminMessages();
            } catch (error) {
                alert('Error deleting message. Please try again.');
                console.error('Error:', error);
            }
        }

        // Load visitations
        async function loadVisitations() {
            try {
                const keys = await window.storage.list('visit:', true);
                if (keys && keys.keys && keys.keys.length > 0) {
                    const visits = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key, true);
                            if (result && result.value) {
                                visits.push({...JSON.parse(result.value), key: key});
                            }
                        } catch (e) {
                            console.log('Error loading visit:', e);
                        }
                    }
                    
                    visits.sort((a, b) => new Date(`${a.date} ${a.time}`) - new Date(`${b.date} ${b.time}`));
                    displayVisitations(visits);
                } else {
                    document.getElementById('visitationList').innerHTML = '<div class="empty-state">No visits scheduled yet.</div>';
                }
            } catch (error) {
                document.getElementById('visitationList').innerHTML = '<div class="empty-state">No visits scheduled yet.</div>';
            }
        }

        // Display visitations
        function displayVisitations(visits) {
            const container = document.getElementById('visitationList');
            if (visits.length === 0) {
                container.innerHTML = '<div class="empty-state">No visits scheduled yet.</div>';
                return;
            }
            
            container.innerHTML = visits.map(visit => `
                <div class="visitation-item">
                    <div class="visitation-info">
                        <div class="visitation-name">${escapeHtml(visit.name)}</div>
                        <div class="visitation-time">${new Date(visit.date).toLocaleDateString('en-US', { 
                            weekday: 'short',
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric'
                        })} at ${visit.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Load admin visitations
        async function loadAdminVisitations() {
            try {
                const keys = await window.storage.list('visit:', true);
                if (keys && keys.keys && keys.keys.length > 0) {
                    const visits = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key, true);
                            if (result && result.value) {
                                visits.push({...JSON.parse(result.value), key: key});
                            }
                        } catch (e) {
                            console.log('Error loading visit:', e);
                        }
                    }
                    
                    visits.sort((a, b) => new Date(`${a.date} ${a.time}`) - new Date(`${b.date} ${b.time}`));
                    displayAdminVisitations(visits);
                } else {
                    document.getElementById('adminVisitationList').innerHTML = '<div class="empty-state">No visitation requests yet.</div>';
                }
            } catch (error) {
                document.getElementById('adminVisitationList').innerHTML = '<div class="empty-state">No visitation requests yet.</div>';
            }
        }

        // Display admin visitations
        function displayAdminVisitations(visits) {
            const container = document.getElementById('adminVisitationList');
            if (visits.length === 0) {
                container.innerHTML = '<div class="empty-state">No visitation requests yet.</div>';
                return;
            }
            
            container.innerHTML = visits.map(visit => `
                <div class="admin-list-item">
                    <div class="admin-list-content">
                        <strong>${escapeHtml(visit.name)}</strong><br>
                        <span style="color: var(--text-dark);">${new Date(visit.date).toLocaleDateString('en-US', { 
                            weekday: 'short',
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric'
                        })} at ${visit.time}</span><br>
                        ${visit.phone ? `<span style="color: var(--admin-dark); font-size: 0.9rem;">üìû ${escapeHtml(visit.phone)}</span>` : ''}
                    </div>
                    <button class="button button-danger" onclick="deleteVisit('${visit.key}')">Delete</button>
                </div>
            `).join('');
        }

        // Delete visit
        async function deleteVisit(key) {
            if (!confirm('Are you sure you want to delete this visitation request?')) return;
            
            try {
                await window.storage.delete(key, true);
                await loadVisitations();
                await loadAdminVisitations();
            } catch (error) {
                alert('Error deleting visit. Please try again.');
                console.error('Error:', error);
            }
        }

        // Handle message form submission
        document.getElementById('messageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('messageName').value;
            const text = document.getElementById('messageText').value;
            
            const message = {
                name: name,
                text: text,
                timestamp: new Date().toISOString()
            };
            
            const key = `message:${Date.now()}`;
            
            try {
                await window.storage.set(key, JSON.stringify(message), true);
                
                document.getElementById('messageSuccess').innerHTML = '<div class="success-message">Your message has been shared! Thank you for your support.</div>';
                document.getElementById('messageForm').reset();
                
                await loadMessages();
                
                setTimeout(() => {
                    document.getElementById('messageSuccess').innerHTML = '';
                }, 5000);
            } catch (error) {
                alert('There was an error saving your message. Please try again.');
                console.error('Error:', error);
            }
        });

        // Handle visitation form submission
        document.getElementById('visitationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('visitorName').value;
            const date = document.getElementById('visitDate').value;
            const time = document.getElementById('visitTime').value;
            const phone = document.getElementById('visitPhone').value;
            
            const visit = {
                name: name,
                date: date,
                time: time,
                phone: phone,
                timestamp: new Date().toISOString()
            };
            
            const key = `visit:${Date.now()}`;
            
            try {
                await window.storage.set(key, JSON.stringify(visit), true);
                
                document.getElementById('visitSuccess').innerHTML = '<div class="success-message">Your visit request has been submitted! We\'ll be in touch soon.</div>';
                document.getElementById('visitationForm').reset();
                
                await loadVisitations();
                
                setTimeout(() => {
                    document.getElementById('visitSuccess').innerHTML = '';
                }, 5000);
            } catch (error) {
                alert('There was an error saving your visit request. Please try again.');
                console.error('Error:', error);
            }
        });

        // Utility function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>
